<!DOCTYPE HTML>
<html xmlns="http://www.w3.org/1999/xhtml" xmlns:th="http://www.thymeleaf.org"  lang="zh">
<head>
    <meta charset="UTF-8">
    <title>ShortUrl</title>
</head>
<script type="text/javascript" th:src="@{/static/js/jquery.min.js}"></script>
<link rel="stylesheet" type="text/css" th:href="@{/static/css/mystyle.css}">
<link rel="shortcut icon" th:href="@{/static/img/favicon.ico}">
<style>

</style>

<body>
<form id="form-url" method="post" action="/add">
    <label for="longurl"> 链接
        <input id="longurl" name="longurl" type="text">
    </label>
    <button type="button" onclick="doSubmit()">提交</button>
</form>
</body>
<script>

    function isUrl(str) {
        const v = new RegExp('^(?!mailto:)(?:(?:http|https|ftp)://|//)(?:\\S+(?::\\S*)?@)?(?:(?:(?:[1-9]\\d?|1\\d\\d|2[01]\\d|22[0-3])(?:\\.(?:1?\\d{1,2}|2[0-4]\\d|25[0-5])){2}(?:\\.(?:[0-9]\\d?|1\\d\\d|2[0-4]\\d|25[0-4]))|(?:(?:[a-z\\u00a1-\\uffff0-9]+-?)*[a-z\\u00a1-\\uffff0-9]+)(?:\\.(?:[a-z\\u00a1-\\uffff0-9]+-?)*[a-z\\u00a1-\\uffff0-9]+)*(?:\\.(?:[a-z\\u00a1-\\uffff]{2,})))|localhost)(?::\\d{2,5})?(?:(/|\\?|#)[^\\s]*)?$', 'i');
        return v.test(str);
    }

    function doSubmit() {
        if (isUrl($("#longurl").val().trim())) {
            $.ajax({
                //几个参数需要注意一下
                type: "POST",//方法类型
                dataType: "json",//预期服务器返回的数据类型
                url: "/insert",//url
                data: $('#form-url').serialize(),
                success: function (result) {
                    if (result.code === 200) {
                        alert(result.msg);
                    } else if (result.code === 400) {
                        alert(result.msg);
                    } else if (result.code === 500) {
                        alert(result.msg);
                    }
                },
                error: function () {
                    alert("异常！");
                }
            });
        } else {
            alert("URL格式不正确！");
        }
    }

</script>
</html>